# 词法作用域

作用域：**`作用域是一套规则，用于确定在何处以及如何查找变量（标识符）。如果查找的目的是对变量进行赋值，那么就会使用LHS查询；如果目的是获取变量的值，就会使用RHS查询`**

作用域的两种主要工作模型：

1. 词法作用域
2. 动态作用域

JavaScript采用的作用域模型是：==词法作用域==

## 2.1、词法阶段

大部分标准语言编译器的工作阶段分为

1. ==词法/词法分析==
2. 解析/语法解析
3. 代码生成

词法化的过程会对源代码中的字符进行检测，如果是有状态的解析过程，还会赋予单词语义。

简单说：词法作用域就是定义在词法阶段的作用域！

换句话说：词法作用域是由你在写代码时将==变量==和==块作用域==写在哪里来决定的

，大部分情况下词法分析器处理代码时会保持作用域不变，但也有一些欺骗词法作用域的方法。

考虑如下代码

```js
function(a){
    var b = a * 2;
    function bar(c) {
        console.log(a,b,c)
    }
    bar(b * 3)
}
foo(2)
//本例中的三个逐级嵌套的作用域，可以理解为几个逐级包含的气泡
```

1. 包含着整个全局作用域，其中只有一个标识符：      foo
2. 包含着foo所创建的作用域,其中三个标识符:             a、b、bar 
3. 包含着bar所创建的作用域，其中只有一个标识符:  c

`查找：`作用域气泡的结构和互相之间的位置关系给引擎提供了足够的位置信息，引擎用这些信息来查找标识符的位置。

无论函数在哪里被调用，也无论它如何被调用，它的词法作用域都只由函数被声明时所处的位置决定。

## 2.2欺骗此法

通过 `eval()函数`或者通过`with关键字`；

评价：**如果代码中大量使用eval(..)或with，那么运行起来一定会变得非常慢。无论引擎多聪明，试图将这些悲观情况的副作用限制在最小范围内，也无法避免如果没有这些优化，代码会运行得更慢这个事实。**

## 2.3小结：

词法作用域意味着作用域是由书写代码时函数声明的位置来决定的。编译的词法分析阶段基本能够知道全部标识符在哪里以及是如何声明的，从而能够预测在执行过程中如何对它们进行查找。

JavaScript中有两个机制可以“欺骗”词法作用域：eval(..)和with。前者可以对一段包含一个或多个声明的“代码”字符串进行演算，并借此来修改已经存在的词法作用域（在运行时）。后者本质上是通过将一个对象的引用当作作用域来处理，将对象的属性当作作用域中的标识符来处理，从而创建了一个新的词法作用域（同样是在运行时）。

这两个机制的副作用是引擎无法在编译时对作用域查找进行优化，因为引擎只能谨慎地认为这样的优化是无效的。使用这其中任何一个机制都将导致代码运行变慢。不要使用它们。